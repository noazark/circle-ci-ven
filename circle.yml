machine:
  pre:
    - "cd /home/ubuntu/.pyenv/plugins/python-build/../.. && git pull && cd -" # upgrading pyenv to latest
    - "eval \"$(pyenv init -)\" && pyenv install --skip-existing $(cat ~/$CIRCLE_PROJECT_REPONAME/runtime.txt | sed 's/python-//')" # installing python version from /runtime.txt
  post:
    - rm -rf ~/virtualenvs/venv-system && virtualenv ~/virtualenvs/venv-system -p /home/ubuntu/.pyenv/versions/$(cat ~/$CIRCLE_PROJECT_REPONAME/runtime.txt | sed 's/python-//')/bin/python
dependencies:
  cache_directories:
    - "/home/ubuntu/.pyenv"
test:
  override:
    - "python run.py"
